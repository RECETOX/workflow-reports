# LC Workflow Execution Summary - The October Prototype

This is a Galaxy Page describing the LC October prototype workflow run on ... **TBA**

## Workflow Inputs
We define three inputs: the collection of raw datasets, compound database for annotation, and adduct table.

### Input Dataset Collection: a mzML collection

This is the main data input -- a collection of MS datasets in the [mzML](https://www.psidev.info/mzML) format (for `apLCMS`).

```galaxy
history_dataset_display(history_dataset_id=TBA)
```

### Input Dataset: Compound database

Database of compounds according to which the annotation is performed (for `xMSannotator`). The database is required to contain the fields `compound_id`, `monoisotopic_mass`, and `molecular_formula`.

```galaxy
history_dataset_display(history_dataset_id=TBA)
```

### Input Dataset: Adduct table

Database of adduct which is combined with the database of compound to form a molecule-adduct pairs (for `xMSannotator`). The database is required to contain `adduct`, `charge`, `mass`, and `n_molecules`.

```galaxy
history_dataset_display(history_dataset_id=TBA)
```

## Peak detection

Tool `apLCMS` is used to generate a feature table from a batch of LC/MS spectra. We use unsupervised analysis approach, which doesn't use existing knowledge. It detects peaks de novo from the data based on the data itself. 

Steps:
- The m/z and retention time tolerance levels are estimated from the data. 
- A run-filter is used to detect peaks and remove noise. 
- Non-parametric statistical methods are used to find-tune peak selection and grouping. 
- Retention time correction.
- A feature table is generated by aligning peaks across spectra.

### Output Dataset: Feature table

The table contains following columns: identification of the feature (`feature`), m/z (`mz`) and retention time (`rt`), identification of source file from mzML collection (`sample`), retention time in respective sample (`sample_rt`), and peak intensity (`sample_intensity`).

```galaxy
history_dataset_display(history_dataset_id=TBA)
```

## Annotation

Tool `xMSannotator` is used to annotate the feature table with compounds from the compound database. 

The annotation process generates all possible compound-adduct pairs and matches those pairs to the measured peaks. A compound-adduct pair is pronounced as a match to a certain peak when the difference of their masses are withing some tolerance. Then, a score and a confidence level is assigned to each match based on peak correlation clustering, metabolite pathway associations, adducts expectations, and isotope conformations.

The tool generates output at each stage:
1. includes modules and retention time based clustering of features without any annotation
2. includes  modules and retention time based clustering of features along with simple m/z based database matching
3. includes scores for annotations assigned in stage 2
4. and 5. include the confidence levels before and after redundancy (multiple matches) filtering, respectively

### Output Dataset: Annotation table

The table contains following columns: original m/z (`mz`) and retention time (`time`), chemical DB identifiers (`chemical_ID`, `Name`, `Formula`), assigned `score` and `confidence`, and others.

```galaxy
history_dataset_display(history_dataset_id=TBA)
```

## Executed Workflow
The following describes all undertaken workflow steps and default tool parameters. 
```galaxy
workflow_display(**TBA**)
```
